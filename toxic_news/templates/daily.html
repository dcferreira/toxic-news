{% include 'header.html' %}
<h1 class="flex items-center font-sans font-bold break-normal text-white px-2 py-4 text-xl md:text-3xl">
    How toxic are newspapers headlines?
</h1>
<h2 class="flex items-center font-semibold font-sans break-normal text-white px-2 text-l md:text-l">
    What is this?</h2>
<div class="px-2 text-sm md:pb-6">
    <p>
        The table below quantifies how toxic the headlines in the main page of each news
        website are.
        For each day, all the headlines are run through
        <a href="https://github.com/unitaryai/detoxify"
           class="text-blue-500 hover:underline">
            Unitary's Detoxify model</a>
        and the scores are averaged.
        The numbers in this table are the averages of those scores for a specific day.
    </p>
</div>
<div id='recipients'
     class="p-8 mt-6 lg:mt-0 sm:rounded-lg shadow-md border-gray-600 bg-gray-700">

    <label>
        <input type="date" id="dateInput" name="day"
               class="bg-gray-600 rounded text-gray-300 mb-3"
               value="{{ today.strftime('%Y-%m-%d') }}"
               min="2018-01-01" max="{{ today.strftime('%Y-%m-%d') }}">
    </label>


    <table id="example" class="stripe hover"
           style="width:100%; padding-top: 1em;  padding-bottom: 1em;">
    </table>

    <script>

    </script>

</div>

<!--Dataframes in JS-->
<script src="https://gmousse.github.io/dataframe-js/dist/dataframe.js"></script>

<!-- jQuery -->
<script type="text/javascript"
        src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<!--Datatables -->
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<script>
    const DataFrame = dfjs.DataFrame;

    const updateTable = (table, fname) => {
        DataFrame.fromCSV(fname).then(df => {
                console.log("UPDATE");
                var data = df.toArray();
                table.clear();
                table.rows.add(data);
                table.draw();

            }
        );
    }

    const columns = [{title: "Name"}, {title: "Toxicity"},
        {title: "Severe Toxicity"}, {title: "Obscene"}, {title: "Identity Attack"},
        {title: "Insult"}, {title: "Threat"}, {title: "Sexually Explicit"}, {title: "#Headlines"}, {title: "Date"}]

    $(document).ready(() => {
        const table = $('#example').DataTable({
            columns: columns,
            scrollX: true,
        });
        updateTable(table, "daily/{{ today.strftime('%Y/%m/%d') }}.csv");

        // buttons
        document.getElementById("dateInput").addEventListener("change", function () {
            var input = this.value;
            var dateEntered = new Date(input);

            const fname = "daily/" + dateEntered.toISOString().substring(0, 10).replace(/-/g, "/") + ".csv";
            updateTable(table, fname);
        });

    });
</script>

{% include 'footer.html' %}
